* Configuration
  
** Personal Information  
   
#+BEGIN_SRC emacs-lisp
(setq user-full-name "Gregor Riegler"
      message-signature nil
      user-mail-address "gregor.riegler@gmail.com")
#+END_SRC

** linum
#+BEGIN_SRC emacs-lisp
(require 'linum)

(global-linum-mode)

(defcustom linum-disabled-modes-list '(eshell-mode wl-summary-mode compilation-mode org-mode text-mode dired-mode doc-view-mode)
  "* List of modes disabled when global linum mode is on"
  :type '(repeat (sexp :tag "Major mode"))
  :tag " Major modes where linum is disabled: "
  :group 'linum
  )
(defcustom linum-disable-starred-buffers 't
  "* Disable buffers that have stars in them like *Gnu Emacs*"
  :type 'boolean
  :group 'linum)

(defun linum-on ()
  "* When linum is running globally, disable line number in modes defined in `linum-disabled-modes-list'. Changed by linum-off. Also turns off numbering in starred modes like *scratch*"

  (unless (or (minibufferp) (member major-mode linum-disabled-modes-list)
              (and linum-disable-starred-buffers (string-match "*" (buffer-name)))
              )
    (linum-mode 1)))

(provide 'setup-linum)

#+END_SRC


** Util
#+BEGIN_SRC emacs-lisp
(defun string/starts-with (s begins)
  "Return non-nil if string S starts with BEGINS."
  (cond ((>= (length s) (length begins))
         (string-equal (substring s 0 (length begins)) begins))
        (t nil)))

#+END_SRC
** Encryption
   #+BEGIN_SRC emacs-lisp
   (require 'epa-file)
   (epa-file-enable)
   #+END_SRC
** winner
#+BEGIN_SRC emacs-lisp
(winner-mode 1)
#+END_SRC
** Ido
#+begin_src emacs-lisp 
(require 'flx-ido)
(ido-mode 1)
(ido-everywhere 1)
(flx-ido-mode 1)
;; disable ido faces to see flx highlights.

(setq ido-enable-flex-matching t)
(setq ido-use-faces nil)
** js-commint
#+BEGIN_SRC emacs-lisp
(require 'js-comint)
(setq inferior-js-program-command (concat user-emacs-directory "nodei.sh"))
(add-hook 'js2-mode-hook '(lambda () 
          (local-set-key "\C-x\C-e" 'js-send-last-sexp)
          (local-set-key "\C-\M-x" 'js-send-last-sexp-and-go)
          (local-set-key "\C-cb" 'js-send-buffer)
          (local-set-key "\C-c\C-b" 'js-send-buffer-and-go)
          (local-set-key "\C-cl" 'js-load-file-and-go)
          ))
#+END_SRC
(setq gc-cons-threshold 20000000)

;; (setq ido-enable-prefix t
;;       ido-enable-flex-matching t)
#+end_src

** Load-Path
   #+begin_src emacs-lisp 
     (add-to-list 'load-path (concat user-emacs-directory "custom"))
     (add-to-list 'load-path (concat user-emacs-directory "custom/use-package"))
   #+end_src
** OTR
#+BEGIN_SRC emacs-lisp
     (load-file (concat user-emacs-directory "custom/jabber-otr/jabber-otr.el"))
#+END_SRC
** Kill process
** Ansi-color
#+BEGIN_SRC emacs-lisp
(autoload 'ansi-color-for-comint-mode-on "ansi-color" nil t)
(add-hook 'shell-mode-hook 'ansi-color-for-comint-mode-on)
(add-hook 'eshell-preoutput-filter-functions
           'ansi-color-filter-apply)

#+END_SRC
#+begin_src emacs-lisp 
  (define-key process-menu-mode-map (kbd "C-k") 'joaot/delete-process-at-point)
  
  (defun joaot/delete-process-at-point ()
    (interactive)
    (let ((process (get-text-property (point) 'tabulated-list-id)))
      (cond ((and process
                  (processp process))
             (delete-process process)
             (revert-buffer))
            (t
             (error "no process at point!")))))
#+end_src
** Dired
#+begin_src emacs-lisp 
(require 'dired-details+)
#+end_src
** mu4e
   #+BEGIN_SRC emacs-lisp
            ;; taken and adapted from http://www.brool.com/index.php/using-mu4e
               
            
            (defun email () 
              (interactive)
              (when (not (featurep 'mu4e))
                (add-to-list 'load-path "/usr/local/share/emacs/site-lisp/mu4e/")
             
                (require 'mu4e)
                (require 'org-mu4e)
             
                (setq mu4e-update-mail-and-index t)
                ;; defaults
             
                (setq mu4e-maildir "~/Maildir")
                (setq mu4e-drafts-folder "/[Gmail].Entw&APw-rfe")
                (setq mu4e-sent-folder   "/[Gmail].Gesendet")
                (setq mu4e-trash-folder  "/[Gmail].Papierkorb")
             
                ;; don't save message to Sent Messages, Gmail/IMAP takes care of this
                (setq mu4e-update-interval 300 mu4e-sent-messages-behavior 'delete)
             
                ;; setup some handy shortcuts
                ;; you can quickly switch to your Inbox -- press ``ji''
                ;; then, when you want archive some messages, move them to
                ;; the 'All Mail' folder by pressing ``ma''.
            
                (setq mu4e-attachment-dir  "~/Downloads")
             
                (setq mu4e-maildir-shortcuts
                      '( ("/INBOX"               . ?i)
                         ("/[Gmail].Wichtig"   . ?!)
                         ("/[Gmail].Markiert"   . ?m)
                         ("/[Gmail].Papierkorb"   . ?p)
                         ("/[Gmail].Spam"   . ?s)
                         ("/[Gmail].Alle Nachrichten"    . ?a)))
            
                (setq mu4e-bookmarks '(
             ("maildir:\"/INBOX\" date:7d..now AND NOT maildir:\"/[Gmail].Spam\"" "INBOX without Spam last 7" ?i)
             ("maildir:\"/INBOX\" AND NOT maildir:\"/[Gmail].Spam\"" "INBOX without Spam" ?j)
             ;; ("flag:unread AND NOT flag:trashed" "Unread messages" 117)
             ;; ("date:today..now" "Today's messages" 116)
             ;; ("date:7d..now" "Last 7 days" 119)
            ))
             
                ;; allow for updating mail using 'U' in the main view:
                ;; I have this running in the background anyway
                (setq mu4e-get-mail-command "offlineimap")
             
                ;; sending mail -- replace USERNAME with your gmail username
                ;; also, make sure the gnutls command line utils are installed
                ;; package 'gnutls-bin' in Debian/Ubuntu
             
                (require 'smtpmail)
             
                 ;; alternatively, for emacs-24 you can use:
                 (setq message-send-mail-function 'smtpmail-send-it
                       smtpmail-stream-type 'starttls
                       smtpmail-default-smtp-server "smtp.gmail.com"
                       smtpmail-smtp-server "smtp.gmail.com"
                       smtpmail-smtp-service 587)
             
             
                 ;; don't include message signature
                 (setq mu4e-compose-signature-auto-include nil)
            
                 ;; set date format (does not overwrite the settings for some reaso)
                 ;; (setq mu4e-headers-date-format "%d.%m.%y")
                 
                ;; don't keep message buffers around
                (setq message-kill-buffer-on-exit t)
             
                ;; show images
                (setq mu4e-show-images t)
             
                ;; use imagemagick, if available
                (when (fboundp 'imagemagick-register-types)
                  (imagemagick-register-types))
             
                ;;; message view action
                (defun mu4e-msgv-action-view-in-browser (msg)
                  "View the body of the message in a web browser."
                  (interactive)
                  (let ((html (mu4e-msg-field (mu4e-message-at-point t) :body-html))
                        (tmpfile (format "%s/%d.html" temporary-file-directory (random))))
                    (unless html (error "No html part for this message"))
                    (with-temp-file tmpfile
                      (insert
                       "<html>"
                       "<head><meta http-equiv=\"content-type\""
                       "content=\"text/html;charset=UTF-8\">"
                       html))
                    (browse-url (concat "file://" tmpfile))))
             
                (add-to-list 'mu4e-view-actions
                             '("View in browser" . mu4e-msgv-action-view-in-browser) t)
             
                ;; convert org mode to HTML automatically
                (setq org-mu4e-convert-to-html t)
             
                ;; need this to convert some e-mails properly
                ;; (setq mu4e-html2text-command "html2text -utf8 -style pretty -width 72")
                (setq mu4e-html2text-command "w3m -cols 72 -dump -T text/html")
            )
              (mu4e)
         )
             
            (defalias 'org-mail 'org-mu4e-compose-org-mode)
      (email)
   (add-hook 'mu4e-compose-mode-hook
      (defun my-setup-epa-hook ()
        (epa-mail-mode)))
   (add-hook 'mu4e-view-mode-hook
     (defun my-view-mode-hook ()
      (epa-mail-mode)))
   
   (require 'smtpmail)
   
   (setq message-send-mail-function 'smtpmail-send-it
         starttls-use-gnutls t
         smtpmail-starttls-credentials
         '(("smtp.gmail.com" 587 nil nil))
         smtpmail-auth-credentials
         (expand-file-name "~/.authinfo.gpg")
         smtpmail-default-smtp-server "smtp.gmail.com"
         smtpmail-smtp-server "smtp.gmail.com"
         smtpmail-smtp-service 587
         smtpmail-debug-info t)
               
   #+END_SRC


** Sauron

#+BEGIN_SRC emacs-lisp
(require 'sauron)
(global-set-key (kbd "C-c s") 'sauron-toggle-hide-show)
(setq sauron-dbus-cookie t)
;; (sr-dbus-drop-cookie)
(setq sauron-max-line-length nil)
(setq sauron-hide-mode-line t)
(setq sauron-separate-frame nil)
(sauron-start-hidden)
(setq sauron-watch-nicks '("hvr" "edwardk"))
(add-hook 'sauron-event-added-functions
  (lambda (origin prio msg &optional props)
    (if (string/starts-with msg "Mail")
      (shell-command (concat "notify-send -i " "/usr/share/icons/gnome/48x48/emblems/emblem-mail.png '" msg "'")))))
#+END_SRC
** Drag-Stuff
#+BEGIN_SRC emacs-lisp
(require 'drag-stuff)
;; (drag-stuff-mode t)
#+END_SRC
** Erc
#+BEGIN_SRC emacs-lisp
(require 'erc)
(load-file (concat user-emacs-directory "custom/erc-scrolltobottom-patch.el"))
(setq erc-autojoin-channels-alist '(("freenode.net" "#emacs" "#haskell")))
(setq erc-hide-list '("JOIN" "PART" "QUIT" "NICK"))
(setq erc-track-exclude-types '("JOIN" "NICK" "PART" "QUIT" "MODE" "324" "329" "332" "333" "353" "477"))
(setq erc-auto-discard-away t)
(setq erc-modules (quote (autoaway autojoin button completion fill irccontrols list match menu move-to-prompt netsplit networks noncommands notifications readonly ring scrolltobottom stamp track)))
(setq erc-fill-static-center 15)
(setq erc-fill-function 'erc-fill-static)

;; (Erc :server "irc.freenode.net" :port 6667 :nick "sleepomeno")

#+END_SRC
** Use-package
   #+begin_src emacs-lisp 
     (require 'use-package)
     (require 'bind-key)
   #+end_src
** Clojure
*** Load the provided Clojure start kit configurations
    #+begin_src emacs-lisp 
      (load (concat user-emacs-directory "clojure-starter-kit.el"))
    #+end_src

*** Cider
#+BEGIN_SRC emacs-lisp
(require 'cider)
(require 'ob-clojure)

(setq nrepl-hide-special-buffers t
      cider-repl-pop-to-buffer-on-connect nil
      cider-popup-stacktraces nil
      cider-repl-popup-stacktraces t)

     ;; Use cider as the clojure execution backend
     (setq org-babel-clojure-backend 'cider) ;
     
     ;; Let's have pretty source code blocks
     (setq org-edit-src-content-indentation 0
           org-src-tab-acts-natively t
           org-src-fontify-natively t
           org-confirm-babel-evaluate nil)
     
    (eval-after-load 'org
      '(progn (add-to-list 'org-structure-template-alist '("k" "#+BEGIN_SRC haskell :results silent\n?\n#+END_SRC" "<src lang='haskell'>\n?\n</src>")) (add-to-list 'org-structure-template-alist
                           '("c" "#+begin_src clojure :tangle src/\n?\n#+end_src", "<src lang='clojure'>\n?\n</src>"))))
#+END_SRC 

**** integration with ac-nrepl
     #+begin_src emacs-lisp 

     (use-package ac-nrepl
       :init (progn
               (add-hook 'cider-repl-mode-hook 'ac-nrepl-setup)
               (add-hook 'cider-mode-hook 'ac-nrepl-setup)
               (eval-after-load "auto-complete"
                 '(add-to-list 'ac-modes 'cider-repl-mode))
     (defun set-auto-complete-as-completion-at-point-function ()
       (setq completion-at-point-functions '(auto-complete)))
     (add-hook 'auto-complete-mode-hook 'set-auto-complete-as-completion-at-point-function)
     
     (add-hook 'cider-repl-mode-hook 'set-auto-complete-as-completion-at-point-function)
     (add-hook 'cider-mode-hook 'set-auto-complete-as-completion-at-point-function)
     (eval-after-load "cider"
       '(define-key cider-mode-map (kbd "C-c C-d") 'ac-nrepl-popup-doc))
               ))     
     #+end_src
** Miscellaneous
*** Set initial buffer
    #+begin_src emacs-lisp 
       (setq initial-buffer-choice "~/org/home.org")
    #+end_src
*** Set PATH
    #+begin_src emacs-lisp 
      (setenv "PATH" (concat (getenv "PATH") ":/home/greg/.cabal/bin:/home/greg/.cask/bin"))
    #+end_src
*** Don't fire up another backtrace when an error happens in debug mode
   
   #+begin_src emacs-lisp 
     (setq eval-expression-debug-on-error nil)
   #+end_src

*** Don't check spelling in every text-mode buffer
   #+begin_src emacs-lisp 
     (remove-hook 'text-mode-hook 'turn-on-flyspell)
   #+end_src
*** Key bindings
#+begin_src emacs-lisp 
;; (global-set-key (kbd "M-l") 'forward-word)
;; (global-set-key (kbd "M-h") 'backward-word)
;; (global-set-key (kbd "M-a") 'find-tag)
#+end_src
**** Always indent on newline

    #+begin_src emacs-lisp 
      (global-set-key (kbd "RET") 'newline-and-indent)
    #+end_src

**** Windows
     #+begin_src emacs-lisp 
       (global-set-key (kbd "C-ä") 'delete-other-windows)
       (global-set-key (kbd "C-Ä") 'delete-window)
       (global-set-key (kbd "ö") 'other-window)
     #+end_src

*** Markdown
    #+begin_src emacs-lisp 
    (add-to-list 'auto-mode-alist '("\\.text\\'" . markdown-mode))
    (add-to-list 'auto-mode-alist '("\\.markdown\\'" . markdown-mode))
    (add-to-list 'auto-mode-alist '("\\.md\\'" . markdown-mode))
    (add-to-list 'auto-mode-alist '("README\\.md\\'" . gfm-mode))
    (setq markdown-open-command "google-chrome")
    #+end_src

*** Global-auto-complete-mode
    #+begin_src emacs-lisp 
    (require 'auto-complete)
    (global-auto-complete-mode t)
    #+end_src

*** Open pdfs mit envince
    #+begin_src emacs-lisp 
      (delete '("\\.pdf\\'" . default) org-file-apps)
      (add-to-list 'org-file-apps '("\\.pdf\\'" . "evince \"%s\""))
      (add-to-list 'org-file-apps '("\\.pdf::\\([0-9]+\\)\\'" . "evince \"%s\" -p %1"))
    #+end_src
** Evil
*** Evil-Leader
    #+begin_src emacs-lisp 
    (setq evil-leader/in-all-states t) 
    (global-evil-leader-mode)
    (evil-leader/set-leader "<SPC>")

    (evil-leader/set-key

      "ef" 'find-file
      "sa" 'sauron-toggle-hide-show
      "sh" 'shell
      "es" 'start-erc
      "m" 'email
      "ff" 'find-function
      "df" 'describe-function
      "<SPC>" 'switch-to-buffer
      ;; go back in current window
      "b" '(lambda (&optional arg) "Keyboard macro." (interactive "p") (kmacro-exec-ring-item (quote ([32 32 return] 0 "%d")) arg))
      ;; go back in other window
      "z" '(lambda (&optional arg) "Keyboard macro." (interactive "p") (kmacro-exec-ring-item (quote ([246 32 98 return 246] 0 "%d")) arg))
      "w" 'save-buffer
      "ci" 'evilnc-comment-or-uncomment-lines
      "cl" 'evilnc-comment-or-uncomment-to-the-line
      "x" 'smex
      "d" 'ido-dired
      "k" 'kill-buffer
      "l" 'ace-jump-line-mode
      "eb" 'erc-track-switch-buffer
      "jc" 'jabber-connect
      ;; "h" 'evil-window-left
      ;; "h" 'evil-window-left
      ;; "l" 'evil-window-right
      ;; "k" 'evil-window-up
      ;; "j" 'evil-window-down
      )

    (evil-leader/set-key-for-mode 'haskell-mode "fh" 'inferior-haskell-find-haddock)
    (evil-leader/set-key-for-mode 'haskell-mode "ca" 'haskell-cabal-visit-file)
    (evil-leader/set-key-for-mode 'haskell-mode "jd" 'haskell-mode-jump-to-def-or-tag)
    #+end_src
*** Activate Evil
    #+begin_src emacs-lisp 
    (use-package evil
      :config (progn
                (evil-mode 1))
      :init
      (progn
        (define-key evil-insert-state-map "j"
          '(lambda ()
             (interactive)
             (insert "j")
             (let ((event (read-event nil)))
               (if (= event ?j)
                   (progn
                     (backward-delete-char 1)
                     (evil-normal-state))
                 (push event unread-command-events)))))
        (define-key evil-motion-state-map (kbd "C-S-u") 'evil-scroll-up)
        (define-key evil-motion-state-map (kbd "SPC") nil)
        (setq evil-emacs-state-modes (append evil-emacs-state-modes '(org-agenda-mode jabber-roster twittering-mode dired-mode mu4e-main-mode mu4e-headers-mode mu4e-view-mode)))
        (evil-set-initial-state 'git-commit-mode 'insert)
        (setq evil-want-C-w-in-emacs-state t
              evilnc-hotkey-comment-operator "##")
        (define-key evil-motion-state-map (kbd "C-S-o") 'evil-execute-in-emacs-state)))
    #+end_src
*** Evil match-it
    #+begin_src emacs-lisp 
    (require 'evil-matchit)
    (global-evil-matchit-mode 1)
    #+end_src
** Forth
    #+begin_src emacs-lisp 
    (load (concat user-emacs-directory "custom/gforth.el"))
    (autoload 'forth-mode "gforth.el")
    (setq auto-mode-alist (cons '("\\.fs\\'" . forth-mode) auto-mode-alist))
    ;; need to run run-forth in your forth file buffer
    #+end_src
** Octorgopress
    #+begin_src emacs-lisp 
    (add-to-list 'org-export-backends 'md)
    (load (concat user-emacs-directory "custom/octorgopress/octorgopress.el"))
    #+end_src
** Paredit
*** Key bindings
#+begin_src emacs-lisp 
(use-package paredit
  ;;     :commands paredit-mode
  :init
  (progn
    (global-set-key (kbd "C-M-h") 'paredit-backward)
    (global-set-key (kbd "C-M-l") 'paredit-forward)
    (global-set-key (kbd "C-c h") 'paredit-backward-slurp-sexp)
    (global-set-key (kbd "C-c j") 'paredit-backward-barf-sexp)
    (global-set-key (kbd "C-c k") 'paredit-forward-barf-sexp)
    (global-set-key (kbd "C-c l") 'paredit-forward-slurp-sexp)
    (global-set-key (kbd "C-M-j") 'paredit-splice-sexp-killing-forward)
    (global-set-key (kbd "C-M-k") 'paredit-splice-sexp-killing-backward)
    (global-set-key (kbd "C-c C-s") 'paredit-split-sexp )
    (global-set-key (kbd "C-c C-j") 'paredit-join-sexps)
    (global-set-key (kbd "C-c C-r") 'paredit-raise-sexp)
    (global-set-key (kbd "C-c x") 'paredit-open-curly)
    (global-set-key (kbd "C-M-s-l ") 'paredit-forward-down)
    (global-set-key (kbd "M-l") 'paredit-forward-up)
    (global-set-key (kbd "C-M-s-h ") 'paredit-backward-down)
    (global-set-key (kbd "M-h") 'paredit-backward-up)
    (global-set-key (kbd "C-c (") 'paredit-wrap-round)
    (global-set-key (kbd "C-c {") 'paredit-wrap-curly)
    (global-set-key (kbd "C-c [") 'paredit-wrap-square)
    ))

;; idea: wenn point am ende der zeile ist ad-do-it zweimal machen
(defadvice paredit-forward (around evil-paredit-forward)
  (let ((insert-state (evil-insert-state-p)))
    (if (not insert-state) (evil-insert-state))
    ad-do-it
    ))

(ad-activate 'paredit-forward)
#+end_src
** Gnuplot
    #+begin_src emacs-lisp 
    (require 'gnuplot)
    (global-set-key (kbd "C-M-g") 'org-plot/gnuplot)
    #+end_src
** Zotelo
#+BEGIN_SRC emacs-lisp
(load (concat user-emacs-directory "custom/zotelo.el"))
(require 'zotelo)
(add-hook 'TeX-mode-hook 'zotelo-minor-mode)

#+END_SRC
** Latex
#+BEGIN_SRC emacs-lisp
(setq TeX-PDF-mode t)
(setq reftex-plug-into-AUCTeX t)

(setq TeX-auto-save t)
(setq TeX-parse-self t)
(setq-default TeX-master nil)

(eval-after-load "tex"
  '(add-to-list 'TeX-command-list
    '("Pdflatex" "pdflatex -interaction nonstopmode %s" TeX-run-command t t :help "Run Pdflatex") t))


#+END_SRC
** Org
*** Org-directory
    #+begin_src emacs-lisp 
      (setq org-directory "~/org")
    #+end_src
*** Org clocking
[[info:org#Resolving%20idle%20time][info:org#Resolving idle time]]
#+BEGIN_SRC emacs-lisp
;;; Cu Cu Cu Cc Cx Ci 
(setq org-clock-continuously nil)
#+END_SRC
*** Refiling
    #+begin_src emacs-lisp 
      (defun my/org-refile-within-current-buffer ()
        "Move the entry at point to another heading in the current buffer."
        (interactive)
        (let ((org-refile-targets '((nil :maxlevel . 5))))
          (org-refile)))
      
      (global-set-key (kbd "C-c C-S-w") 'my/org-refile-within-current-buffer)
    #+end_src
*** Keywords
    #+begin_src emacs-lisp 
      (setq org-todo-keywords (quote ((sequence "TOREAD" "READ") (sequence "TODO" "DONE"))))
      (setq org-todo-keyword-faces
            '(
              ("UTODO"  . (:foreground "#b70101" :weight bold :slant italic))
              ("UTOLEARN"  . (:foreground "#b70101" :weight bold :slant italic))
              ("UTOIMPLEMENT"  . (:foreground "#b70101" :weight bold :slant italic))
              ;; ("STARTED"  . (:foreground "#b70101" :weight bold))
              ;; ("APPT"  . (:foreground "sienna" :weight bold))
              ;; ("PROJ"  . (:foreground "blue" :weight bold))
              ;; ("ZKTO"  . (:foreground "orange" :weight bold))
              ;; ("WAITING"  . (:foreground "orange" :weight bold))
              ;; ("DONE"  . (:foreground "forestgreen" :weight bold))
              ;; ("DELEGATED"  . (:foreground "forestgreen" :weight bold))
              ;; ("CANCELED"  . shadow)
              ))
    #+end_src
*** Captures
#+begin_src emacs-lisp 
(use-package org-protocol
             :init (progn
                     (setq org-protocol-default-template-key "l")
                     (setq org-capture-templates
                           '(("t" "Todo" entry (file+olp "~/org/home.org" "Tasks")
                              "* TODO %?")
                             ;; ("w" "TOTWEET" entry (file+olp "~/org/home.org" "Tasks")
                             ;;  "* TOTWEET %?")
                             ;; ("b" "starting with b...")
                             ;; ("bu" "Tobuy" entry (file+olp "~/org/home.org" "Tasks")
                             ;;  "* TOBUY %?")
                             ("l" "TOBLOG" entry (file+olp "~/org/home.org" "Blog")
                              "* TOBLOG %^{Heading}\n\t%?")
                             ;; ("l" "starting with l... ")
                             ("i" "Link" entry (file+olp "~/org/bookmarks.org" "Bookmarks")
                              "* %a\n %?\n %i")
                             ("b" "TOBLOG from Browser" entry (file+olp "~/org/home.org" "Blog")
                              "* TOBLOG %?\n\t%a")
                             ("o" "TOLOOKAT" entry (file+olp "~/org/home.org" "Tasks")
                              "* TOLOOKAT %?")
                             ("u" "TOLOOKAT from Browser" entry (file+olp "~/org/home.org" "Tasks")
                              "* TOLOOKAT %?\n\t%a")
                             ("t" "TODO from Browser" entry (file+olp "~/org/home.org" "Tasks")
                              "* TODO %?\n\t%a")
                             ("p" "Project" entry (file+olp "~/org/projects.org" "Programming")
                              "* %^{Heading}\n\t%?")
                             ("r" "TOREAD" entry (file+olp "~/org/home.org" "Bücher")
                              "* TOREAD %^{Heading}\n\t%?")
                             ("y" "Journal prompted" item (file+datetree+prompt "~/org/journal.org.gpg")
                              "%?")
                             ("j" "Journal" item (file+datetree "~/org/journal.org.gpg")
                              "%?")))
                     (define-key global-map "\C-cc" 'org-capture)))
#+end_src
*** Agenda
#+begin_src emacs-lisp 
(setq org-agenda-files (list "~/org/cal.org" "~/org/bookmarks.org" "~/org/projects.org" "~/org/home.org" "~/org/uni.org" "~/org/french.org"))
(setq org-agenda-custom-commands
      '(("u" todo "UTODO|UTOLEARN|UTOIMPLEMENT")
        ("l" todo "TOLOOKAT")
        ("d" todo "TODO")))

(setq org-agenda-skip-deadline-if-done t)
(setq org-agenda-skip-scheduled-if-done t)

;; (defun org-my-auto-exclude-function (tag)
;;   (and (or (string= tag "keys") (string= tag "drill"))
;;        (concat "-" tag)))

(defun org-my-auto-exclude-function (tag)
  (and (string= tag "keys") (concat "-" tag)))

(setq org-agenda-auto-exclude-function 'org-my-auto-exclude-function)
#+end_src

**** Sometimes Agenda doesn't work
    #+begin_src emacs-lisp 
      (setq org-agenda-archives-mode nil)
      (setq org-agenda-skip-comment-trees nil)
      (setq org-agenda-skip-function nil)
    #+end_src
*** Calendar
    #+begin_src emacs-lisp 
    (load-file "~/.emacs.d/custom/org-caldav.el")
    (use-package org-caldav
      :init (progn 
              (setq org-icalendar-exclude-tags (quote ("training" "habit")))
              (setq org-icalendar-include-body nil)
              (setq org-icalendar-use-scheduled (quote nil))
              (define-key evil-normal-state-map (kbd "C-p") 'org-caldav-sync)
              
              (global-set-key (kbd "C-ü")
                              '(lambda (&optional arg) "Keyboard macro." (interactive "p") (kmacro-exec-ring-item (quote ([134217848 111 114 103 45 99 97 108 100 97 118 45 115 121 110 99 return 111 114 46 114 105 101 103 108 101 114 64 103 109 97 105 108 46 99 111 109 return 119 97 97 114 115 110 118 116 102 120 102 120 121 112 118 106 return] 0 "%d")) arg)))
              (setq org-caldav-calendar-id "lm94as0bqk7f5f6kmluf0k655c@group.calendar.google.com")
              (setq org-icalendar-timezone "Europe/Berlin")
              (setq org-caldav-inbox "~/org/cal.org")
              (setq org-caldav-files (list "~/org/home.org" "~/org/uni.org"))
              (setq org-caldav-sync-changes-to-org 'title-only)
              (setq org-icalendar-include-todo nil)
              (setq org-icalendar-store-UID t)
        
              (global-set-key (kbd "C-c b")
                              '(lambda (&optional arg) "Keyboard macro." (interactive "p") (kmacro-exec-ring-item (quote ([246 32 98 return 246] 0 "%d")) arg)))
              ))
         
    #+end_src
*** General
    #+begin_src emacs-lisp 
    (setq org-refile-targets (quote ((org-agenda-files :maxlevel . 2))))
    (setq org-M-RET-may-split-line nil)
    (setq org-goto-interface 'outline org-goto-max-level 10)
    (add-to-list 'auto-mode-alist '("\\.org$" . org-mode))
    (global-set-key "\C-cL" 'org-store-link)
    (global-set-key "\C-ca" 'org-agenda)

    (global-set-key (kbd "M-o") 'imenu)

    (setq org-log-done 'time)
    (setq org-clock-persist 'history)
    (org-clock-persistence-insinuate)
    (setq org-return-follows-link t)
    #+end_src

*** Export
#+begin_src emacs-lisp 
(setq org-export-with-toc nil)
#+end_src
*** Org-learn
    #+begin_src emacs-lisp 
    (load-file (concat user-emacs-directory "custom/org-mode/contrib/lisp/org-learn.el"))
    (require 'org-learn)
    #+end_src
*** Org-freemind
     #+begin_src emacs-lisp 
     (require 'org-freemind)
     (load-file (concat user-emacs-directory "custom/org-mode/contrib/lisp/ox-freemind.el"))
     (require 'ox-freemind)
     #+end_src
*** Org-effectiveness
    #+begin_src emacs-lisp 
    (load-file (concat user-emacs-directory "custom/org-mode/contrib/lisp/org-effectiveness.el"))
    (require 'org-effectiveness)
    #+end_src
*** Org-velocity
    #+begin_src emacs-lisp 
    (load-file (concat user-emacs-directory "custom/org-mode/contrib/lisp/org-velocity.el"))
    (require 'org-velocity)
    #+end_src
*** Org-habit
#+begin_src emacs-lisp 
(require 'org-habit)
(setq org-habit-show-habits-only-for-today t)
#+end_src

*** Org-drill
    #+begin_src emacs-lisp 
    (load-file (concat user-emacs-directory "custom/org-mode/contrib/lisp/org-drill.el"))
    (use-package org-drill
      :init (progn (setq org-drill-learn-fraction 0.45)
                   (setq org-drill-match "-nodrill")))
    #+end_src
*** Org-mobile
    #+begin_src emacs-lisp 
    (add-hook 'after-init-hook 'org-mobile-pull)
    (add-hook 'kill-emacs-hook 'org-mobile-push)
    (setq org-mobile-inbox-for-pull "~/org/notes.org")
    (setq org-mobile-directory "~/Dropbox/Apps/MobileOrg")
    #+end_src
*** Org-Babel
    #+begin_src emacs-lisp 
      (setq org-src-fontify-natively t)
      (setq org-confirm-babel-evaluate nil)
      (setq org-src-window-setup 'current-window)
    #+end_src
**** Emacs-lisp
     #+begin_src emacs-lisp 
     (eval-after-load 'org
       '(add-to-list 'org-structure-template-alist
                     '("x" "#+begin_src emacs-lisp \n?\n#+end_src", "<src lang='emacs-lisp'>\n?\n</src>")))
     
     #+end_src
**** R
     #+begin_src emacs-lisp 
     (eval-after-load 'org
       (progn
         '(add-to-list 'org-structure-template-alist
                       '("r"  "#+begin_src R :results silent :session sess1\n?\n#+end_src", "<src lang='R'>\n?\n</src>"))
         '(org-babel-do-load-languages
           'org-babel-load-languages
           '((emacs-lisp . t)
             (R . t)
             (haskell . t)
             (gnuplot . t)
             (C . t)
             (dot . t)))))
     #+end_src
           
    #+begin_src emacs-lisp 
      (require 'ess)
    #+end_src
**** Clojure
     #+begin_src emacs-lisp 
                  (add-to-list 'org-babel-tangle-lang-exts '("clojure" . "clj"))
                  
                  (defvar org-babel-default-header-args:clojure 
                    '((:results . "silent")))
     #+end_src
**** Haskell
     #+begin_src emacs-lisp 
     (load-file "~/.emacs.d/custom/ob-haskell.el")
     (require 'ob-haskell)
     #+end_src
*** Org-attach
    #+begin_src emacs-lisp 
      (require 'org-attach)
      (org-add-link-type "att" 'org-attach-open-link)
      (defun org-attach-open-link (file)
        (org-open-file (org-attach-expand file)))
      (set-variable 'org-attach-store-link-p t)
    #+end_src
*** Org-dotemacs
#+begin_src emacs-lisp 
  (setq org-dotemacs-default-file (concat user-emacs-directory "configuration.org"))
#+end_src
*** Latex
**** Include Bibtex call
#+begin_src emacs-lisp 
  (use-package org-latex
    :init (progn
            (setq org-latex-create-formula-image-program 'dvipng)
            (setq org-latex-pdf-process '("pdflatex -interaction nonstopmode -output-directory %o %f""pdflatex -interaction nonstopmode -output-directory %o %f" "bibtex %b" "pdflatex -interaction nonstopmode -output-directory %o %f"))
            (add-to-list 'org-latex-classes
                         '("termpaper"
                           "\\documentclass{article}
                 [NO-DEFAULT-PACKAGES]
                 [NO-PACKAGES]"
                           ("\\section{%s}" . "\\section*{%s}")
                           ("\\subsection{%s}" . "\\subsection*{%s}")
                           ("\\subsubsection{%s}" . "\\subsubsection*{%s}")
                           ("\\paragraph{%s}" . "\\paragraph*{%s}")
                           ("\\subparagraph{%s}" . "\\subparagraph*{%s}"))
                         )
            ))
  
#+end_src
**** Beamer
#+begin_src emacs-lisp 
(use-package ox-beamer)
(setq org-beamer-outline-frame-options "")
#+end_src
** Haskell
*** Loading
#+BEGIN_SRC emacs-lisp
(add-to-list 'load-path (concat user-emacs-directory "custom/haskell-mode"))
(load "haskell-mode-autoloads.el")

(require 'w3m-haddock)
(add-hook 'w3m-display-hook 'w3m-haddock-display)
#+END_SRC
*** Settings
    #+begin_src emacs-lisp 
    (setq haskell-hoogle-command nil)
    (setq haskell-package-conf-file "/usr/local/lib/ghc-7.8.2/package.conf")
    (setq haskell-process-path-cabal-dev "/home/greg/.cabal/bin/cabal")
    (setq haskell-process-path-ghci "ghci")
    (setq haskell-process-suggest-remove-import-lines nil)
    (setq haskell-process-suggest-hoogle-imports t)
    (setq haskell-interactive-popup-errors nil)
    (setq haskell-interactive-types-for-show-ambiguous t)
    (setq haskell-process-auto-import-loaded-modules t)
    (setq haskell-process-prompt-restart-on-cabal-change t)
    (setq haskell-process-suggest-language-pragmas nil)
    (setq haskell-process-type (quote cabal-repl))
    (setq haskell-process-args-ghci '("-package-conf" ".cabal-sandbox/x86_64-linux-ghc-7.8.2-packages.conf.d" "-i../dist/build/autogen" "-idist/build/autogen" "-isrc" "-i../src" "-fno-warn-unused-binds"))
    (setq haskell-program-name "cabal repl")
    (setq haskell-stylish-on-save nil)
    (setq haskell-process-log t)
    (setq haskell-process-args-cabal-repl '("--ghc-option=-ferror-spans" "--ghc-option=+RTS" "--ghc-option=-M1.5g")) 
        
    (setq haskell-tags-on-save nil)
    (setq inferior-haskell-web-docs-base "http://hackage.haskell.org/package/")
    (setq ghc-core-program-args '("-O0" "-dsuppress-all"))
    #+end_src
*** Hooks
   #+begin_src emacs-lisp 
   
          (eval-after-load "haskell-mode"
            '(progn
              ;; (define-key haskell-mode-map (kbd "C-x C-d") nil)
   (define-key haskell-mode-map (kbd "C-,") 'haskell-move-nested-left)
       (define-key haskell-mode-map (kbd "C-.") 'haskell-move-nested-right)
              (define-key haskell-mode-map "\C-ch" 'haskell-hoogle)
              (define-key haskell-mode-map (kbd "C-c C-z") 'haskell-interactive-switch)
              (define-key haskell-mode-map (kbd "C-c C-l") 'haskell-process-load-file)
              (define-key haskell-mode-map (kbd "C-c C-b") 'haskell-interactive-switch)
              ;; (define-key haskell-mode-map (kbd "C-c C-d") 'haskell-w3m-open-haddock)
              (define-key haskell-mode-map (kbd "C-c C-d") 'inferior-haskell-find-haddock)
              (define-key haskell-mode-map (kbd "C-c C-t") 'haskell-process-do-type)
              (define-key haskell-mode-map (kbd "C-c C-i") 'haskell-process-do-info)
              (define-key haskell-mode-map (kbd "SPC") 'haskell-mode-contextual-space)
              (define-key haskell-mode-map (kbd "C-c M-.") 'haskell-mode-jump-to-def-or-tag)
   ;; (define-key haskell-mode-map (kbd "C-c C-d") nil)
   ))
          (add-hook 'haskell-mode-hook 'turn-on-haskell-doc-mode)
          (add-hook 'haskell-mode-hook 'turn-on-haskell-indentation)
          (add-hook 'haskell-mode-hook 'flymake-haskell-multi-load)
          (defun haskell-hook ()
            (define-key evil-normal-state-map (kbd "M-.") 'haskell-mode-jump-to-def-or-tag)
            (define-key haskell-mode-map (kbd "C-#") 'haskell-interactive-bring)
            )
          (defun haskell-cabal-hook ()
            (define-key haskell-cabal-mode-map (kbd "C-c C-c") 'haskell-process-cabal-build)
            (define-key haskell-cabal-mode-map (kbd "C-c c") 'haskell-process-cabal)
            (define-key haskell-cabal-mode-map (kbd "C-c C-l") 'save-buffer)
            (define-key haskell-cabal-mode-map (kbd "C-#") 'haskell-interactive-bring)
            (define-key haskell-cabal-mode-map [?\C-c ?\C-z] 'haskell-interactive-switch))
          (add-hook 'haskell-cabal-mode-hook 'haskell-cabal-hook)
          (add-hook 'haskell-mode-hook 'haskell-hook)
   #+end_src
*** Aligments
#+BEGIN_SRC emacs-lisp
(eval-after-load "align" (progn
(add-to-list 'align-rules-list
             '(haskell-types
               (regexp . "\\(\\s-+\\)\\(::\\|∷\\)\\s-+")
               (modes quote (haskell-mode literate-haskell-mode))))
(add-to-list 'align-rules-list
             '(haskell-assignment
               (regexp . "\\(\\s-+\\)=\\s-+")
               (modes quote (haskell-mode literate-haskell-mode))))
(add-to-list 'align-rules-list
             '(haskell-arrows
               (regexp . "\\(\\s-+\\)\\(->\\|→\\)\\s-+")
               (modes quote (haskell-mode literate-haskell-mode))))
(add-to-list 'align-rules-list
             '(haskell-left-arrows
               (regexp . "\\(\\s-+\\)\\(<-\\|←\\)\\s-+")
               (modes quote (haskell-mode literate-haskell-mode))))))
#+END_SRC
*** Imports
#+BEGIN_SRC emacs-lisp
(define-key haskell-mode-map [f8] 'haskell-navigate-imports)
#+END_SRC
*** Flymake
    #+begin_src emacs-lisp 
      (eval-after-load 'flymake '(require 'flymake-cursor))
      (setq flymake-cursor-number-of-errors-to-display nil)
      (setq flymake-gui-warnings-enabled nil)
      (define-key haskell-mode-map  (kbd "C-c e") 'flymake-display-err-menu-for-current-line)
      (define-key haskell-mode-map (kbd "C-c C-n") 'flymake-goto-next-error)
      (define-key haskell-mode-map  (kbd "C-c C-p") 'flymake-goto-next-error)
    #+end_src
** Jabber
#+BEGIN_SRC emacs-lisp
(setq jabber-account-list  '(("sleepomeno@blah.im/emacs")))
#+END_SRC
** OTR
#+BEGIN_SRC emacs-lisp
;; (load-file (concat user-emacs-directory "custom/jabber-otr/jabber-otr.el"))
#+END_SRC
** Projectile
   #+begin_src emacs-lisp 
     (setq projectile-use-native-indexing t)
   #+end_src
** Common Lisp
   #+begin_src emacs-lisp 
     (setq inferior-lisp-program "/usr/bin/clisp")
   #+end_src
*** 
